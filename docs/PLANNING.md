# Планирование

Агент работает в режиме планирования: перед выполнением задачи он составляет план действий, который затем последовательно выполняет.

## Процесс планирования

1. **Инициализация плана:** При получении новой задачи от пользователя оркестратор вызывает ИИ для составления списка шагов в формате JSON.
2. **Хранение:** План сохраняется в табличную часть «План» справочника **ИИА_Диалоги**.
3. **Выполнение:** Оркестратор последовательно берет невыполненные пункты плана и генерирует для них соответствующие DSL-команды.
4. **Обновление:** После выполнения каждого шага DSL план обновляется — ИИ анализирует результат выполнения и помечает пункты плана как выполненные или требующие повтора/корректировки.
5. **Дополнение:** Если в процессе диалога пользователь уточняет задачу, агент может дополнить существующий план новыми пунктами.

## Алгоритм работы (Оркестратор)

Основной цикл планирования и выполнения реализован в модуле `ИИА_Оркестратор.ВыполнитьЦикл()`:

- Если плана нет → `ИнициализироватьПлан()`
- Если план есть, но не завершён → `СгенерироватьПродолжениеВыполнения()`
- После выполнения DSL → `ОбновитьПланПоРезультатам()`
- Если все пункты выполнены → `ВыполнитьФинальнуюПроверкуИSummary()`

## Преимущества планирования

- **Прозрачность:** Пользователь видит, что именно собирается сделать агент.
- **Управляемость:** Возможность остановки или корректировки процесса на любом этапе.
- **Надёжность:** Разделение этапа «что делать» и «как делать» снижает вероятность ошибок в сложных сценариях.
- **RAG-интеграция:** При планировании учитываются подсказки из RAG-поиска по метаданным.
