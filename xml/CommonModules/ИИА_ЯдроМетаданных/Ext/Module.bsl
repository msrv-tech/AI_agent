// Модуль ядра метаданных типовых конфигураций 1С.
// Используется для буста score в RAG-поиске: объекты из ядра поднимаются в топ результатов.

#Область ПрограммныйИнтерфейс

// Проверяет, входит ли объект метаданных в ядро для данной конфигурации.
// Используется для буста score в RAG-поиске.
//
// Параметры:
//  Тип - Строка - тип объекта: "AccumReg", "Catalog", "InfoReg", "Document" и т.д.
//  Имя - Строка - имя объекта (без префикса)
//  ИмяКонфигурации - Строка - имя конфигурации (Метаданные.Имя или из ИИА_СтатусИндексаRAG)
//
// Возвращаемое значение:
//  Булево - Истина, если объект в ядре
//
Функция ОбъектВЯдре(Тип, Имя, ИмяКонфигурации) Экспорт
	
	Если ПустаяСтрока(Имя) Тогда
		Возврат Ложь;
	КонецЕсли;
	
	ИдКонфигурации = ОпределитьИдКонфигурации(ИмяКонфигурации);
	МножествоЯдра = ПолучитьМножествоЯдра(ИдКонфигурации);
	
	Ключ = Тип + "|" + Имя;
	Возврат МножествоЯдра[Ключ] = Истина;
	
КонецФункции

// Возвращает идентификатор конфигурации по имени (паттерны). Для отладки RAG.
Функция ОпределитьИдКонфигурации(ИмяКонфигурации) Экспорт
	
	ИмяВРег = ВРег(СокрЛП(Строка(ИмяКонфигурации)));
	
	Если ПустаяСтрока(ИмяВРег) Тогда
		Возврат "Unknown";
	КонецЕсли;
	
	// Управление торговлей (УТ 11)
	Если Найти(ИмяВРег, "УПРАВЛЕНИЕТОРГОВЛЕЙ") > 0 Или Найти(ИмяВРег, "ТОРГОВЛ") > 0 Тогда
		Возврат "UT";
	КонецЕсли;
	
	// Управление предприятием (ERP 2)
	Если Найти(ИмяВРег, "УПРАВЛЕНИЕПРЕДПРИЯТИЕМ") > 0 Или Найти(ИмяВРег, "ERP") > 0 Тогда
		Возврат "ERP";
	КонецЕсли;
	
	// Розница
	Если Найти(ИмяВРег, "РОЗНИЦА") > 0 Тогда
		Возврат "Roznica";
	КонецЕсли;
	
	// Бухгалтерия предприятия (БП 3.0)
	Если Найти(ИмяВРег, "БУХГАЛТЕРИЯ") > 0 Или Найти(ИмяВРег, "БП") > 0 Тогда
		Возврат "BP";
	КонецЕсли;
	
	// Управление небольшой фирмой (УНФ)
	Если Найти(ИмяВРег, "УНФ") > 0 Или Найти(ИмяВРег, "МАЛЫЙБИЗНЕС") > 0 
		Или Найти(ИмяВРег, "НЕБОЛЬШОЙФИРМ") > 0 Тогда
		Возврат "UNF";
	КонецЕсли;
	
	// КонфигурацияТест, ЗИК
	Если Найти(ИмяВРег, "КОНФИГУРАЦИЯТЕСТ") > 0 Или Найти(ИмяВРег, "ЗИК") > 0 Тогда
		Возврат "Test";
	КонецЕсли;
	
	Возврат "Unknown";
	
КонецФункции

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Возвращает соответствие Ключ (Тип|Имя) -> Истина для объектов ядра данной конфигурации
Функция ПолучитьМножествоЯдра(ИдКонфигурации)
	
	МассивПар = ПолучитьМассивПарЯдра(ИдКонфигурации);
	Результат = Новый Соответствие;
	
	Для Каждого Пара Из МассивПар Цикл
		Ключ = Пара.Ключ.Тип + "|" + Пара.Ключ.Имя;
		Результат.Вставить(Ключ, Истина);
	КонецЦикла;
	
	Возврат Результат;
	
КонецФункции

// Возвращает массив структур {Тип, Имя} для объектов ядра
Функция ПолучитьМассивПарЯдра(ИдКонфигурации)
	
	МассивПар = Новый Массив;
	
	// УТ 11
	Если ИдКонфигурации = "UT" Тогда
		ДобавитьПарУТ(МассивПар);
		Возврат МассивПар;
	КонецЕсли;
	
	// ERP 2
	Если ИдКонфигурации = "ERP" Тогда
		ДобавитьПарERP(МассивПар);
		Возврат МассивПар;
	КонецЕсли;
	
	// Розница
	Если ИдКонфигурации = "Roznica" Тогда
		ДобавитьПарРозница(МассивПар);
		Возврат МассивПар;
	КонецЕсли;
	
	// БП 3.0
	Если ИдКонфигурации = "BP" Тогда
		ДобавитьПарБП(МассивПар);
		Возврат МассивПар;
	КонецЕсли;
	
	// УНФ (Малый бизнес)
	Если ИдКонфигурации = "UNF" Тогда
		ДобавитьПарУНФ(МассивПар);
		Возврат МассивПар;
	КонецЕсли;
	
	// КонфигурацияТест, ЗИК — общие объекты
	Если ИдКонфигурации = "Test" Тогда
		ДобавитьПарНеизвестная(МассивПар);
		Возврат МассивПар;
	КонецЕсли;
	
	// Unknown — объекты для нераспознанной конфигурации
	ДобавитьПарНеизвестная(МассивПар);
	Возврат МассивПар;
	
КонецФункции

Процедура ДобавитьПарУТ(МассивПар)
	ДобавитьПар(МассивПар, "AccumReg", "ТоварыНаСкладах");
	ДобавитьПар(МассивПар, "AccumReg", "РасчетыСКлиентами");
	ДобавитьПар(МассивПар, "InfoReg", "ЦеныНоменклатуры");
	ДобавитьПар(МассивПар, "InfoReg", "ЦеныНоменклатуры25");
	ДобавитьПар(МассивПар, "Catalog", "Номенклатура");
	ДобавитьПар(МассивПар, "Catalog", "Партнеры");
	ДобавитьПар(МассивПар, "Catalog", "Контрагенты");
	ДобавитьПар(МассивПар, "Catalog", "Валюты");
	ДобавитьПар(МассивПар, "Document", "ЗаказКлиента");
	ДобавитьПар(МассивПар, "Document", "СчетНаОплатуКлиенту");
	ДобавитьПар(МассивПар, "Document", "РеализацияТоваровУслуг");
	ДобавитьПар(МассивПар, "Document", "ПоступлениеТоваровУслуг");
КонецПроцедуры

Процедура ДобавитьПарERP(МассивПар)
	ДобавитьПар(МассивПар, "AccumReg", "РасчетыСКлиентами");
	ДобавитьПар(МассивПар, "InfoReg", "ЦеныНоменклатуры");
	ДобавитьПар(МассивПар, "InfoReg", "ЦеныНоменклатуры25");
	ДобавитьПар(МассивПар, "Catalog", "Партнеры");
	ДобавитьПар(МассивПар, "Catalog", "Контрагенты");
	ДобавитьПар(МассивПар, "Catalog", "Номенклатура");
	ДобавитьПар(МассивПар, "Document", "ЗаказКлиента");
	ДобавитьПар(МассивПар, "Document", "СчетНаОплатуКлиенту");
	ДобавитьПар(МассивПар, "Document", "РеализацияТоваровУслуг");
КонецПроцедуры

Процедура ДобавитьПарРозница(МассивПар)
	ДобавитьПар(МассивПар, "AccumReg", "ТоварыНаСкладах");
	ДобавитьПар(МассивПар, "AccumReg", "ДенежныеСредстваБезналичные");
	ДобавитьПар(МассивПар, "InfoReg", "ЦеныНоменклатуры");
	ДобавитьПар(МассивПар, "Catalog", "Номенклатура");
	ДобавитьПар(МассивПар, "Catalog", "Контрагенты");
	ДобавитьПар(МассивПар, "Catalog", "ДоговорыКонтрагентов");
	ДобавитьПар(МассивПар, "Catalog", "Организации");
	ДобавитьПар(МассивПар, "Catalog", "Магазины");
	ДобавитьПар(МассивПар, "Catalog", "ВидыЦен");
	ДобавитьПар(МассивПар, "Document", "ЧекККМ");
	ДобавитьПар(МассивПар, "Document", "ОтчетОРозничныхПродажах");
	ДобавитьПар(МассивПар, "Document", "ЗаказПокупателя");
	ДобавитьПар(МассивПар, "Document", "ПоступлениеТоваров");
	ДобавитьПар(МассивПар, "Document", "ПеремещениеТоваров");
	ДобавитьПар(МассивПар, "Document", "СписаниеТоваров");
	ДобавитьПар(МассивПар, "Document", "ВозвратТоваровОтПокупателя");
	ДобавитьПар(МассивПар, "Document", "УстановкаЦенНоменклатуры");
	ДобавитьПар(МассивПар, "Document", "РегистрацияБезналичнойОплаты");
КонецПроцедуры

Процедура ДобавитьПарБП(МассивПар)
	ДобавитьПар(МассивПар, "AccumReg", "Взаиморасчеты");
	ДобавитьПар(МассивПар, "InfoReg", "ЦеныНоменклатуры");
	ДобавитьПар(МассивПар, "Catalog", "Номенклатура");
	ДобавитьПар(МассивПар, "Catalog", "Контрагенты");
	ДобавитьПар(МассивПар, "Catalog", "ДоговорыКонтрагентов");
	ДобавитьПар(МассивПар, "Catalog", "Организации");
	ДобавитьПар(МассивПар, "Document", "РеализацияТоваровУслуг");
	ДобавитьПар(МассивПар, "Document", "ПоступлениеТоваровУслуг");
	ДобавитьПар(МассивПар, "Document", "СчетНаОплатуПокупателю");
	ДобавитьПар(МассивПар, "Document", "КорректировкаРеализации");
	ДобавитьПар(МассивПар, "Document", "КорректировкаДолга");
	ДобавитьПар(МассивПар, "Document", "СписаниеСРасчетногоСчета");
	ДобавитьПар(МассивПар, "Document", "ПоступлениеНаРасчетныйСчет");
	ДобавитьПар(МассивПар, "Document", "РасходныйКассовыйОрдер");
	ДобавитьПар(МассивПар, "Document", "ОтчетОРозничныхПродажах");
КонецПроцедуры

Процедура ДобавитьПарУНФ(МассивПар)
	ДобавитьПар(МассивПар, "AccumReg", "Запасы");
	ДобавитьПар(МассивПар, "AccumReg", "ЗапасыНаСкладах");
	ДобавитьПар(МассивПар, "AccumReg", "Продажи");
	ДобавитьПар(МассивПар, "AccumReg", "ДенежныеСредства");
	ДобавитьПар(МассивПар, "AccumReg", "РасчетыСПокупателями");
	ДобавитьПар(МассивПар, "AccumReg", "РасчетыСПоставщиками");
	ДобавитьПар(МассивПар, "AccumReg", "РасчетыСПрочимиКонтрагентами");
	ДобавитьПар(МассивПар, "InfoReg", "ЦеныНоменклатуры");
	ДобавитьПар(МассивПар, "Catalog", "Номенклатура");
	ДобавитьПар(МассивПар, "Document", "ПриходнаяНакладная");
	ДобавитьПар(МассивПар, "Document", "РасходнаяНакладная");
	ДобавитьПар(МассивПар, "Document", "СчетНаОплату");
	ДобавитьПар(МассивПар, "Document", "ЗаказПокупателя");
	ДобавитьПар(МассивПар, "Document", "ЗаказПоставщику");
	ДобавитьПар(МассивПар, "Document", "ОтчетОРозничныхПродажах");
	ДобавитьПар(МассивПар, "Document", "ЧекККМ");
	ДобавитьПар(МассивПар, "Document", "ЧекККМВозврат");
КонецПроцедуры

Процедура ДобавитьПарНеизвестная(МассивПар)
	ДобавитьПар(МассивПар, "AccumReg", "ТоварыНаСкладах");
	ДобавитьПар(МассивПар, "AccumReg", "Продажи");
	ДобавитьПар(МассивПар, "AccumReg", "РасчетыСКлиентами");
	ДобавитьПар(МассивПар, "AccumReg", "РасчетыСПокупателями");
	ДобавитьПар(МассивПар, "AccumReg", "РасчетыСПоставщиками");
	ДобавитьПар(МассивПар, "AccumReg", "ДенежныеСредства");
	ДобавитьПар(МассивПар, "InfoReg", "ЦеныНоменклатуры");
	ДобавитьПар(МассивПар, "InfoReg", "ЦеныНоменклатуры25");
	ДобавитьПар(МассивПар, "Catalog", "Номенклатура");
	ДобавитьПар(МассивПар, "Catalog", "Контрагенты");
	ДобавитьПар(МассивПар, "Catalog", "ДоговорыКонтрагентов");
	ДобавитьПар(МассивПар, "Catalog", "Организации");
	ДобавитьПар(МассивПар, "Document", "ЗаказКлиента");
	ДобавитьПар(МассивПар, "Document", "ЗаказПокупателя");
	ДобавитьПар(МассивПар, "Document", "СчетНаОплатуКлиенту");
	ДобавитьПар(МассивПар, "Document", "СчетНаОплатуПокупателю");
	ДобавитьПар(МассивПар, "Document", "РеализацияТоваровУслуг");
	ДобавитьПар(МассивПар, "Document", "ПоступлениеТоваровУслуг");
	ДобавитьПар(МассивПар, "Document", "ОтчетОРозничныхПродажах");
	ДобавитьПар(МассивПар, "Document", "ЧекККМ");
	ДобавитьПар(МассивПар, "Document", "УстановкаЦенНоменклатуры");
КонецПроцедуры

Процедура ДобавитьПар(МассивПар, Тип, Имя)
	Ключ = Новый Структура("Тип, Имя", Тип, Имя);
	МассивПар.Добавить(Новый Структура("Ключ", Ключ));
КонецПроцедуры

#КонецОбласти
