#Область ПрограммныйИнтерфейс

// Получает список всех справочников конфигурации
//
// Возвращаемое значение:
//  Массив - массив структур с информацией о справочниках:
//   * Имя - Строка - имя справочника
//   * Синоним - Строка - синоним справочника
//
Функция ПолучитьСписокСправочников() Экспорт
	
	Результат = Новый Массив;
	
	Для Каждого МетаданныеСправочника Из Метаданные.Справочники Цикл
		
		Элемент = Новый Структура;
		Элемент.Вставить("Имя", МетаданныеСправочника.Имя);
		Элемент.Вставить("Синоним", МетаданныеСправочника.Синоним);
		
		Результат.Добавить(Элемент);
		
	КонецЦикла;
	
	Возврат Результат;
	
КонецФункции

// Получает список всех документов конфигурации
//
// Возвращаемое значение:
//  Массив - массив структур с информацией о документах:
//   * Имя - Строка - имя документа
//   * Синоним - Строка - синоним документа
//
Функция ПолучитьСписокДокументов() Экспорт
	
	Результат = Новый Массив;
	
	Для Каждого МетаданныеДокумента Из Метаданные.Документы Цикл
		
		Элемент = Новый Структура;
		Элемент.Вставить("Имя", МетаданныеДокумента.Имя);
		Элемент.Вставить("Синоним", МетаданныеДокумента.Синоним);
		
		Результат.Добавить(Элемент);
		
	КонецЦикла;
	
	Возврат Результат;
	
КонецФункции

// Получает список всех регистров сведений конфигурации
//
// Возвращаемое значение:
//  Массив - массив структур с информацией о регистрах:
//   * Имя - Строка - имя регистра
//   * Синоним - Строка - синоним регистра
//
Функция ПолучитьСписокРегистровСведений() Экспорт
	
	Результат = Новый Массив;
	
	Для Каждого МетаданныеРегистра Из Метаданные.РегистрыСведений Цикл
		
		Элемент = Новый Структура;
		Элемент.Вставить("Имя", МетаданныеРегистра.Имя);
		Элемент.Вставить("Синоним", МетаданныеРегистра.Синоним);
		
		Результат.Добавить(Элемент);
		
	КонецЦикла;
	
	Возврат Результат;
	
КонецФункции

// Получает список всех регистров накопления конфигурации
//
// Возвращаемое значение:
//  Массив - массив структур с информацией о регистрах:
//   * Имя - Строка - имя регистра
//   * Синоним - Строка - синоним регистра
//
Функция ПолучитьСписокРегистровНакопления() Экспорт
	
	Результат = Новый Массив;
	
	Для Каждого МетаданныеРегистра Из Метаданные.РегистрыНакопления Цикл
		
		Элемент = Новый Структура;
		Элемент.Вставить("Имя", МетаданныеРегистра.Имя);
		Элемент.Вставить("Синоним", МетаданныеРегистра.Синоним);
		
		Результат.Добавить(Элемент);
		
	КонецЦикла;
	
	Возврат Результат;
	
КонецФункции

// Получает список всех регистров бухгалтерии конфигурации
//
// Возвращаемое значение:
//  Массив - массив структур с информацией о регистрах:
//   * Имя - Строка - имя регистра
//   * Синоним - Строка - синоним регистра
//
Функция ПолучитьСписокРегистровБухгалтерии() Экспорт
	
	Результат = Новый Массив;
	
	Для Каждого МетаданныеРегистра Из Метаданные.РегистрыБухгалтерии Цикл
		
		Элемент = Новый Структура;
		Элемент.Вставить("Имя", МетаданныеРегистра.Имя);
		Элемент.Вставить("Синоним", МетаданныеРегистра.Синоним);
		
		Результат.Добавить(Элемент);
		
	КонецЦикла;
	
	Возврат Результат;
	
КонецФункции

// Получает реквизиты справочника
//
// Параметры:
//  ИмяСправочника - Строка - имя справочника
//
// Возвращаемое значение:
//  Структура - структура с информацией о справочнике:
//   * Найден - Булево - найден ли справочник
//   * Имя - Строка - имя справочника
//   * Синоним - Строка - синоним справочника
//   * Реквизиты - Массив - массив структур с реквизитами:
//     * Имя - Строка - имя реквизита
//     * Синоним - Строка - синоним реквизита
//     * Тип - Строка - строковое представление типа
//
Функция ПолучитьРеквизитыСправочника(ИмяСправочника) Экспорт
	
	Результат = Новый Структура;
	Результат.Вставить("Найден", Ложь);
	Результат.Вставить("Имя", "");
	Результат.Вставить("Синоним", "");
	Результат.Вставить("Реквизиты", Новый Массив);
	
	МетаданныеСправочника = Метаданные.Справочники.Найти(ИмяСправочника);
	
	Если МетаданныеСправочника = Неопределено Тогда
		Возврат Результат;
	КонецЕсли;
	
	Результат.Найден = Истина;
	Результат.Имя = МетаданныеСправочника.Имя;
	Результат.Синоним = МетаданныеСправочника.Синоним;
	
	// Получаем реквизиты
	Для Каждого Реквизит Из МетаданныеСправочника.Реквизиты Цикл
		
		Элемент = Новый Структура;
		Элемент.Вставить("Имя", Реквизит.Имя);
		Элемент.Вставить("Синоним", Реквизит.Синоним);
		Элемент.Вставить("Тип", ПолучитьСтроковоеПредставлениеТипа(Реквизит.Тип));
		
		Результат.Реквизиты.Добавить(Элемент);
		
	КонецЦикла;
	
	// Добавляем основные стандартные реквизиты
	СписoкСтандартных = Новый Массив;
	СписoкСтандартных.Добавить("Код");
	СписoкСтандартных.Добавить("Наименование");
	СписoкСтандартных.Добавить("ПометкаУдаления");
	СписoкСтандартных.Добавить("ЭтоГруппа");
	СписoкСтандартных.Добавить("Родитель");
	СписoкСтандартных.Добавить("Владелец");

	
	Для Каждого ИмяСтандартного Из СписoкСтандартных Цикл
		
		Элемент = Новый Структура;
		Элемент.Вставить("Имя", ИмяСтандартного);
				
		Результат.Реквизиты.Добавить(Элемент);

	КонецЦикла;
	
	Возврат Результат;
	
КонецФункции

// Получает реквизиты документа
//
// Параметры:
//  ИмяДокумента - Строка - имя документа
//
// Возвращаемое значение:
//  Структура - структура с информацией о документе:
//   * Найден - Булево - найден ли документ
//   * Имя - Строка - имя документа
//   * Синоним - Строка - синоним документа
//   * Реквизиты - Массив - массив структур с реквизитами
//   * ТабличныеЧасти - Массив - массив структур с табличными частями
//
Функция ПолучитьРеквизитыДокумента(ИмяДокумента) Экспорт
	
	Результат = Новый Структура;
	Результат.Вставить("Найден", Ложь);
	Результат.Вставить("Имя", "");
	Результат.Вставить("Синоним", "");
	Результат.Вставить("Реквизиты", Новый Массив);
	Результат.Вставить("ТабличныеЧасти", Новый Массив);
	
	МетаданныеДокумента = Метаданные.Документы.Найти(ИмяДокумента);
	
	Если МетаданныеДокумента = Неопределено Тогда
		Возврат Результат;
	КонецЕсли;
	
	Результат.Найден = Истина;
	Результат.Имя = МетаданныеДокумента.Имя;
	Результат.Синоним = МетаданныеДокумента.Синоним;
	
	// Получаем реквизиты
	Для Каждого Реквизит Из МетаданныеДокумента.Реквизиты Цикл
		
		Элемент = Новый Структура;
		Элемент.Вставить("Имя", Реквизит.Имя);
		Элемент.Вставить("Синоним", Реквизит.Синоним);
		Элемент.Вставить("Тип", ПолучитьСтроковоеПредставлениеТипа(Реквизит.Тип));
		
		Результат.Реквизиты.Добавить(Элемент);
		
	КонецЦикла;
	
	// Добавляем основные стандартные реквизиты
	СписoкСтандартных = Новый Массив;
	СписoкСтандартных.Добавить("Номер");
	СписoкСтандартных.Добавить("Дата");
	СписoкСтандартных.Добавить("ПометкаУдаления");
	СписoкСтандартных.Добавить("Проведен");
	
	Для Каждого ИмяСтандартного Из СписoкСтандартных Цикл
		
		Элемент = Новый Структура;
		Элемент.Вставить("Имя", ИмяСтандартного);
		
		Результат.Реквизиты.Добавить(Элемент);
		
	КонецЦикла;
	
	// Получаем табличные части
	Для Каждого ТабличнаяЧасть Из МетаданныеДокумента.ТабличныеЧасти Цикл
		
		Элемент = Новый Структура;
		Элемент.Вставить("Имя", ТабличнаяЧасть.Имя);
		Элемент.Вставить("Синоним", ТабличнаяЧасть.Синоним);
		
		Результат.ТабличныеЧасти.Добавить(Элемент);
		
	КонецЦикла;
	
	Возврат Результат;
	
КонецФункции

// Проверяет существование справочника
//
// Параметры:
//  ИмяСправочника - Строка - имя справочника
//
// Возвращаемое значение:
//  Булево - существует ли справочник
//
Функция СуществуетСправочник(ИмяСправочника) Экспорт
	
	Возврат Метаданные.Справочники.Найти(ИмяСправочника) <> Неопределено;
	
КонецФункции

// Проверяет существование документа
//
// Параметры:
//  ИмяДокумента - Строка - имя документа
//
// Возвращаемое значение:
//  Булево - существует ли документ
//
Функция СуществуетДокумент(ИмяДокумента) Экспорт
	
	Возврат Метаданные.Документы.Найти(ИмяДокумента) <> Неопределено;
	
КонецФункции

// Проверяет существование реквизита в справочнике
//
// Параметры:
//  ИмяСправочника - Строка - имя справочника
//  ИмяРеквизита - Строка - имя реквизита
//
// Возвращаемое значение:
//  Булево - существует ли реквизит
//
Функция СуществуетРеквизитСправочника(ИмяСправочника, ИмяРеквизита) Экспорт
	
	МетаданныеСправочника = Метаданные.Справочники.Найти(ИмяСправочника);
	
	Если МетаданныеСправочника = Неопределено Тогда
		Возврат Ложь;
	КонецЕсли;
	
	// Проверяем обычные реквизиты
	Если МетаданныеСправочника.Реквизиты.Найти(ИмяРеквизита) <> Неопределено Тогда
		Возврат Истина;
	КонецЕсли;
	
	// Проверяем стандартные реквизиты
	// Стандартные реквизиты справочника: Код, Наименование, Ссылка, ПометкаУдаления, Предопределенный, ЭтоГруппа
	СтандартныеРеквизитыСправочника = Новый Массив;
	СтандартныеРеквизитыСправочника.Добавить("Код");
	СтандартныеРеквизитыСправочника.Добавить("Наименование");
	СтандартныеРеквизитыСправочника.Добавить("Ссылка");
	СтандартныеРеквизитыСправочника.Добавить("ПометкаУдаления");
	СтандартныеРеквизитыСправочника.Добавить("Предопределенный");
	СтандартныеРеквизитыСправочника.Добавить("ЭтоГруппа");
	
	Для Каждого СтандартныйРеквизит Из СтандартныеРеквизитыСправочника Цикл
		Если ВРег(СтандартныйРеквизит) = ВРег(ИмяРеквизита) Тогда
			Возврат Истина;
		КонецЕсли;
	КонецЦикла;
	
	Возврат Ложь;
	
КонецФункции

// Проверяет существование реквизита в документе
//
// Параметры:
//  ИмяДокумента - Строка - имя документа
//  ИмяРеквизита - Строка - имя реквизита
//
// Возвращаемое значение:
//  Булево - существует ли реквизит
//
Функция СуществуетРеквизитДокумента(ИмяДокумента, ИмяРеквизита) Экспорт
	
	МетаданныеДокумента = Метаданные.Документы.Найти(ИмяДокумента);
	
	Если МетаданныеДокумента = Неопределено Тогда
		Возврат Ложь;
	КонецЕсли;
	
	// Проверяем обычные реквизиты
	Если МетаданныеДокумента.Реквизиты.Найти(ИмяРеквизита) <> Неопределено Тогда
		Возврат Истина;
	КонецЕсли;
	
	// Проверяем стандартные реквизиты
	// Стандартные реквизиты документа: Номер, Дата, Ссылка, ПометкаУдаления, Проведен
	СтандартныеРеквизитыДокумента = Новый Массив;
	СтандартныеРеквизитыДокумента.Добавить("Номер");
	СтандартныеРеквизитыДокумента.Добавить("Дата");
	СтандартныеРеквизитыДокумента.Добавить("Ссылка");
	СтандартныеРеквизитыДокумента.Добавить("ПометкаУдаления");
	СтандартныеРеквизитыДокумента.Добавить("Проведен");
	
	Для Каждого СтандартныйРеквизит Из СтандартныеРеквизитыДокумента Цикл
		Если ВРег(СтандартныйРеквизит) = ВРег(ИмяРеквизита) Тогда
			Возврат Истина;
		КонецЕсли;
	КонецЦикла;
	
	Возврат Ложь;
	
КонецФункции

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Получает строковое представление типа данных
//
// Параметры:
//  Тип - ОписаниеТипов - описание типа
//
// Возвращаемое значение:
//  Строка - строковое представление типа
//
Функция ПолучитьСтроковоеПредставлениеТипа(Тип)
	
	Если Тип.Типы().Количество() = 0 Тогда
		Возврат "Неопределено";
	КонецЕсли;
	
	ПервыйТип = Тип.Типы()[0];
	
	СтрокаТипа = Строка(ПервыйТип);
	
	Если СтрокаТипа = "Строка" Тогда
		Возврат "Строка";
	ИначеЕсли СтрокаТипа = "Число" Тогда
		Возврат "Число";
	ИначеЕсли СтрокаТипа = "Дата" Тогда
		Возврат "Дата";
	ИначеЕсли СтрокаТипа = "Булево" Тогда
		Возврат "Булево";
	ИначеЕсли СтрНачинаетсяС(СтрокаТипа, "СправочникСсылка.") Тогда
		Возврат СтрокаТипа;
	ИначеЕсли СтрНачинаетсяС(СтрокаТипа, "ДокументСсылка.") Тогда
		Возврат СтрокаТипа;
	ИначеЕсли СтрНачинаетсяС(СтрокаТипа, "ПеречислениеСсылка.") Тогда
		Возврат СтрокаТипа;
	Иначе
		Возврат СтрокаТипа;
	КонецЕсли;
	
КонецФункции

#КонецОбласти

