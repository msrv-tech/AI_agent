#Область ПрограммныйИнтерфейс

// Проверяет DSL JSON
//
// Параметры:
//  DSLJSON - Строка - JSON с DSL командами
//
// Возвращаемое значение:
//  Структура - структура результата:
//   * Успех - Булево - успешность проверки
//   * Сообщение - Строка - описание ошибки или пусто
//   * Сценарий - Структура - распарсенный сценарий (если успешно)
//
Функция ПроверитьDSL(DSLJSON) Экспорт
	
	Результат = Новый Структура;
	Результат.Вставить("Успех", Ложь);
	Результат.Вставить("Сообщение", "");
	Результат.Вставить("Сценарий", Неопределено);
	
	// Проверяем, что JSON не пустой
	Если ПустаяСтрока(DSLJSON) Тогда
		Результат.Сообщение = "DSL JSON пуст";
		Возврат Результат;
	КонецЕсли;
	
	// Парсим JSON
	Попытка
		
		ЧтениеJSON = Новый ЧтениеJSON;
		ЧтениеJSON.УстановитьСтроку(DSLJSON);
		Сценарий = ПрочитатьJSON(ЧтениеJSON);
		ЧтениеJSON.Закрыть();
		
	Исключение
		
		Результат.Сообщение = "Ошибка парсинга JSON: " + ОписаниеОшибки();
		Возврат Результат;
		
	КонецПопытки;
	
	// Проверяем структуру сценария
	Если ТипЗнч(Сценарий) <> Тип("Структура") Тогда
		Результат.Сообщение = "Сценарий должен быть объектом JSON";
		Возврат Результат;
	КонецЕсли;
	
	// Проверяем версию DSL
	Если НЕ Сценарий.Свойство("dsl_version") Тогда
		Результат.Сообщение = "Отсутствует поле dsl_version";
		Возврат Результат;
	КонецЕсли;
	
	Если ТипЗнч(Сценарий.dsl_version) <> Тип("Число") Тогда
		Результат.Сообщение = "dsl_version должен быть числом";
		Возврат Результат;
	КонецЕсли;
	
	Если Сценарий.dsl_version <> 1 Тогда
		Результат.Сообщение = "Неподдерживаемая версия DSL: " + Формат(Сценарий.dsl_version, "ЧН=0");
		Возврат Результат;
	КонецЕсли;
	
	// Проверяем наличие steps
	Если НЕ Сценарий.Свойство("steps") Тогда
		Результат.Сообщение = "Отсутствует поле steps";
		Возврат Результат;
	КонецЕсли;
	
	Если ТипЗнч(Сценарий.steps) <> Тип("Массив") Тогда
		Результат.Сообщение = "steps должен быть массивом";
		Возврат Результат;
	КонецЕсли;
	
	Если Сценарий.steps.Количество() = 0 Тогда
		Результат.Сообщение = "Массив steps пуст";
		Возврат Результат;
	КонецЕсли;
	
	// Проверяем каждый шаг
	Для Индекс = 0 По Сценарий.steps.Количество() - 1 Цикл
		
		Шаг = Сценарий.steps[Индекс];
		
		Если ТипЗнч(Шаг) <> Тип("Структура") Тогда
			Результат.Сообщение = "Шаг " + Формат(Индекс + 1, "ЧН=0") + " должен быть объектом";
			Возврат Результат;
		КонецЕсли;
		
		Если НЕ Шаг.Свойство("action") Тогда
			Результат.Сообщение = "Шаг " + Формат(Индекс + 1, "ЧН=0") + ": отсутствует поле action";
			Возврат Результат;
		КонецЕсли;
		
		Если ТипЗнч(Шаг.action) <> Тип("Строка") Тогда
			Результат.Сообщение = "Шаг " + Формат(Индекс + 1, "ЧН=0") + ": action должен быть строкой";
			Возврат Результат;
		КонецЕсли;
		
		// Проверяем, что action в белом списке
		Если НЕ РазрешенныеДействия().Найти(Шаг.action) <> Неопределено Тогда
			Результат.Сообщение = "Шаг " + Формат(Индекс + 1, "ЧН=0") + ": неизвестное действие '" + Шаг.action + "'";
			Возврат Результат;
		КонецЕсли;
		
		// Валидация конкретных действий
		РезультатВалидации = ВалидироватьШаг(Шаг, Индекс + 1);
		Если НЕ РезультатВалидации.Успех Тогда
			Результат.Сообщение = РезультатВалидации.Сообщение;
			Возврат Результат;
		КонецЕсли;
		
	КонецЦикла;
	
	// Все проверки пройдены
	Результат.Успех = Истина;
	Результат.Сценарий = Сценарий;
	
	Возврат Результат;
	
КонецФункции

// Выполняет DSL команды
//
// Параметры:
//  DSLJSON - Строка - JSON с DSL командами
//
// Возвращаемое значение:
//  Структура - структура результата:
//   * Успех - Булево - успешность выполнения
//   * Сообщение - Строка - описание ошибки или пусто
//   * Результаты - Массив - массив результатов выполнения шагов
//
Функция ВыполнитьDSL(DSLJSON) Экспорт
	
	Результат = Новый Структура;
	Результат.Вставить("Успех", Ложь);
	Результат.Вставить("Сообщение", "");
	Результат.Вставить("Результаты", Новый Массив);
	
	// Сначала проверяем DSL
	РезультатПроверки = ПроверитьDSL(DSLJSON);
	
	Если НЕ РезультатПроверки.Успех Тогда
		Результат.Сообщение = РезультатПроверки.Сообщение;
		Возврат Результат;
	КонецЕсли;
	
	Сценарий = РезультатПроверки.Сценарий;
	
	// Создаем контекст выполнения
	КонтекстВыполнения = Новый Структура;
	
	// Выполняем шаги
	Для Каждого Шаг Из Сценарий.steps Цикл
		
		//@skip-check query-in-loop
		РезультатШага = ВыполнитьШаг(Шаг, КонтекстВыполнения);
		Результат.Результаты.Добавить(РезультатШага);
		
		// Если шаг завершился с ошибкой, останавливаем выполнение
		Если НЕ РезультатШага.Успех Тогда
			Результат.Сообщение = "Ошибка выполнения шага '" + Шаг.action + "': " + РезультатШага.Сообщение;
			Возврат Результат;
		КонецЕсли;
		
	КонецЦикла;
	
	Результат.Успех = Истина;
	
	Возврат Результат;
	
КонецФункции

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

// Возвращает массив разрешенных действий
//
// Возвращаемое значение:
//  Массив - массив строк с именами разрешенных действий
//
Функция РазрешенныеДействия()
	
	Действия = Новый Массив;
	Действия.Добавить("CreateDocument");
	Действия.Добавить("CreateReference");
	Действия.Добавить("FindReferenceByName");
	Действия.Добавить("SetField");
	Действия.Добавить("Write");
	Действия.Добавить("RunQuery");
	Действия.Добавить("ShowInfo");
	
	Возврат Действия;
	
КонецФункции

// Валидирует шаг сценария
//
// Параметры:
//  Шаг - Структура - структура шага
//  НомерШага - Число - номер шага (для сообщений об ошибках)
//
// Возвращаемое значение:
//  Структура - структура результата валидации:
//   * Успех - Булево
//   * Сообщение - Строка
//
Функция ВалидироватьШаг(Шаг, НомерШага)
	
	Результат = Новый Структура;
	Результат.Вставить("Успех", Истина);
	Результат.Вставить("Сообщение", "");
	
	Действие = Шаг.action;
	
	Если Действие = "CreateReference" Тогда
		
		Если НЕ Шаг.Свойство("object_name") Тогда
			Результат.Успех = Ложь;
			Результат.Сообщение = "Шаг " + Формат(НомерШага, "ЧН=0") + ": CreateReference требует поле object_name";
			Возврат Результат;
		КонецЕсли;
		
		Если НЕ ИИА_Метаданные.СуществуетСправочник(Шаг.object_name) Тогда
			Результат.Успех = Ложь;
			Результат.Сообщение = "Шаг " + Формат(НомерШага, "ЧН=0") + ": справочник '" + Шаг.object_name + "' не найден";
			Возврат Результат;
		КонецЕсли;
		
	ИначеЕсли Действие = "CreateDocument" Тогда
		
		Если НЕ Шаг.Свойство("object_name") Тогда
			Результат.Успех = Ложь;
			Результат.Сообщение = "Шаг " + Формат(НомерШага, "ЧН=0") + ": CreateDocument требует поле object_name";
			Возврат Результат;
		КонецЕсли;
		
		Если НЕ ИИА_Метаданные.СуществуетДокумент(Шаг.object_name) Тогда
			Результат.Успех = Ложь;
			Результат.Сообщение = "Шаг " + Формат(НомерШага, "ЧН=0") + ": документ '" + Шаг.object_name + "' не найден";
			Возврат Результат;
		КонецЕсли;
		
	ИначеЕсли Действие = "FindReferenceByName" Тогда
		
		Если НЕ Шаг.Свойство("object_name") Тогда
			Результат.Успех = Ложь;
			Результат.Сообщение = "Шаг " + Формат(НомерШага, "ЧН=0") + ": FindReferenceByName требует поле object_name";
			Возврат Результат;
		КонецЕсли;
		
		Если НЕ Шаг.Свойство("name") Тогда
			Результат.Успех = Ложь;
			Результат.Сообщение = "Шаг " + Формат(НомерШага, "ЧН=0") + ": FindReferenceByName требует поле name";
			Возврат Результат;
		КонецЕсли;
		
		Если НЕ ИИА_Метаданные.СуществуетСправочник(Шаг.object_name) Тогда
			Результат.Успех = Ложь;
			Результат.Сообщение = "Шаг " + Формат(НомерШага, "ЧН=0") + ": справочник '" + Шаг.object_name + "' не найден";
			Возврат Результат;
		КонецЕсли;
		
	ИначеЕсли Действие = "SetField" Тогда
		
		Если НЕ Шаг.Свойство("field") Тогда
			Результат.Успех = Ложь;
			Результат.Сообщение = "Шаг " + Формат(НомерШага, "ЧН=0") + ": SetField требует поле field";
			Возврат Результат;
		КонецЕсли;
		
		Если НЕ Шаг.Свойство("value") Тогда
			Результат.Успех = Ложь;
			Результат.Сообщение = "Шаг " + Формат(НомерШага, "ЧН=0") + ": SetField требует поле value";
			Возврат Результат;
		КонецЕсли;
		
	ИначеЕсли Действие = "RunQuery" Тогда
		
		Если НЕ Шаг.Свойство("query") Тогда
			Результат.Успех = Ложь;
			Результат.Сообщение = "Шаг " + Формат(НомерШага, "ЧН=0") + ": RunQuery требует поле query";
			Возврат Результат;
		КонецЕсли;
		
	ИначеЕсли Действие = "ShowInfo" Тогда
		
		Если НЕ Шаг.Свойство("message") Тогда
			Результат.Успех = Ложь;
			Результат.Сообщение = "Шаг " + Формат(НомерШага, "ЧН=0") + ": ShowInfo требует поле message";
			Возврат Результат;
		КонецЕсли;
		
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

// Выполняет один шаг сценария
//
// Параметры:
//  Шаг - Структура - структура шага
//  КонтекстВыполнения - Структура - контекст выполнения (входной/выходной)
//
// Возвращаемое значение:
//  Структура - структура результата выполнения:
//   * Успех - Булево
//   * Сообщение - Строка
//   * Данные - Произвольный - дополнительные данные результата
//
Функция ВыполнитьШаг(Шаг, КонтекстВыполнения)
	
	Результат = Новый Структура;
	Результат.Вставить("Успех", Ложь);
	Результат.Вставить("Сообщение", "");
	Результат.Вставить("Данные", Неопределено);
	
	Действие = Шаг.action;
	
	Попытка
		
		Если Действие = "CreateReference" Тогда
			
			Результат = ВыполнитьCreateReference(Шаг, КонтекстВыполнения);
			
		ИначеЕсли Действие = "CreateDocument" Тогда
			
			Результат = ВыполнитьCreateDocument(Шаг, КонтекстВыполнения);
			
		ИначеЕсли Действие = "FindReferenceByName" Тогда
			
			Результат = ВыполнитьFindReferenceByName(Шаг, КонтекстВыполнения);
			
		ИначеЕсли Действие = "SetField" Тогда
			
			Результат = ВыполнитьSetField(Шаг, КонтекстВыполнения);
			
		ИначеЕсли Действие = "Write" Тогда
			
			Результат = ВыполнитьWrite(Шаг, КонтекстВыполнения);
			
		ИначеЕсли Действие = "RunQuery" Тогда
			
			Результат = ВыполнитьRunQuery(Шаг);
			
		ИначеЕсли Действие = "ShowInfo" Тогда
			
			Результат = ВыполнитьShowInfo(Шаг);
			
		Иначе
			
			Результат.Сообщение = "Неизвестное действие: " + Действие;
			
		КонецЕсли;
		
	Исключение
		
		Результат.Сообщение = "Ошибка выполнения шага '" + Действие + "': " + ОписаниеОшибки();
		
	КонецПопытки;
	
	Возврат Результат;
	
КонецФункции

// Выполняет действие CreateReference
//
// Параметры:
//  Шаг - Структура - структура шага
//  КонтекстВыполнения - Структура - контекст выполнения (входной/выходной)
//
// Возвращаемое значение:
//  Структура - структура результата
//
Функция ВыполнитьCreateReference(Шаг, КонтекстВыполнения)
	
	Результат = Новый Структура;
	Результат.Вставить("Успех", Ложь);
	Результат.Вставить("Сообщение", "");
	Результат.Вставить("Данные", Неопределено);
	
	ИмяСправочника = Шаг.object_name;
	
	// Получаем менеджер справочника
	МенеджерСправочника = Справочники[ИмяСправочника];
	
	Если МенеджерСправочника = Неопределено Тогда
		Результат.Сообщение = "Не удалось получить менеджер справочника '" + ИмяСправочника + "'";
		Возврат Результат;
	КонецЕсли;
	
	// Создаем новый элемент
	НовыйЭлемент = МенеджерСправочника.СоздатьЭлемент();
	
	// Сохраняем ссылку на созданный элемент в контексте выполнения
	// (для последующих шагов SetField)
	КонтекстВыполнения.Вставить("ТекущийОбъект", НовыйЭлемент);
	КонтекстВыполнения.Вставить("ТипОбъекта", "Справочник");
	КонтекстВыполнения.Вставить("ИмяОбъекта", ИмяСправочника);
	
	Результат.Успех = Истина;
	Результат.Сообщение = "Создан элемент справочника '" + ИмяСправочника + "'";
	Результат.Данные = НовыйЭлемент.Ссылка;
	
	Возврат Результат;
	
КонецФункции

// Выполняет действие CreateDocument
//
// Параметры:
//  Шаг - Структура - структура шага
//  КонтекстВыполнения - Структура - контекст выполнения (входной/выходной)
//
// Возвращаемое значение:
//  Структура - структура результата
//
Функция ВыполнитьCreateDocument(Шаг, КонтекстВыполнения)
	
	Результат = Новый Структура;
	Результат.Вставить("Успех", Ложь);
	Результат.Вставить("Сообщение", "");
	Результат.Вставить("Данные", Неопределено);
	
	ИмяДокумента = Шаг.object_name;
	
	// Получаем менеджер документа
	МенеджерДокумента = Документы[ИмяДокумента];
	
	Если МенеджерДокумента = Неопределено Тогда
		Результат.Сообщение = "Не удалось получить менеджер документа '" + ИмяДокумента + "'";
		Возврат Результат;
	КонецЕсли;
	
	// Создаем новый документ
	НовыйДокумент = МенеджерДокумента.СоздатьДокумент();
	
	// Сохраняем ссылку на созданный документ в контексте выполнения
	КонтекстВыполнения.Вставить("ТекущийОбъект", НовыйДокумент);
	КонтекстВыполнения.Вставить("ТипОбъекта", "Документ");
	КонтекстВыполнения.Вставить("ИмяОбъекта", ИмяДокумента);
	
	Результат.Успех = Истина;
	Результат.Сообщение = "Создан документ '" + ИмяДокумента + "'";
	Результат.Данные = НовыйДокумент.Ссылка;
	
	Возврат Результат;
	
КонецФункции

// Выполняет действие FindReferenceByName
//
// Параметры:
//  Шаг - Структура - структура шага
//  КонтекстВыполнения - Структура - контекст выполнения (входной/выходной)
//
// Возвращаемое значение:
//  Структура - структура результата
//
Функция ВыполнитьFindReferenceByName(Шаг, КонтекстВыполнения)
	
	Результат = Новый Структура;
	Результат.Вставить("Успех", Ложь);
	Результат.Вставить("Сообщение", "");
	Результат.Вставить("Данные", Неопределено);
	
	ИмяСправочника = Шаг.object_name;
	ИмяДляПоиска = Шаг.name;
	
	// Получаем менеджер справочника
	МенеджерСправочника = Справочники[ИмяСправочника];
	
	Если МенеджерСправочника = Неопределено Тогда
		Результат.Сообщение = "Не удалось получить менеджер справочника '" + ИмяСправочника + "'";
		Возврат Результат;
	КонецЕсли;
	
	// Ищем по наименованию
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ ПЕРВЫЕ 1
	|	Элементы.Ссылка
	|ИЗ
	|	Справочник." + ИмяСправочника + " КАК Элементы
	|ГДЕ
	|	Элементы.Наименование = &Наименование";
	
	Запрос.УстановитьПараметр("Наименование", ИмяДляПоиска);
	
	РезультатЗапроса = Запрос.Выполнить();
	
	Если РезультатЗапроса.Пустой() Тогда
		Результат.Сообщение = "Элемент справочника '" + ИмяСправочника + "' с наименованием '" + ИмяДляПоиска + "' не найден";
		Возврат Результат;
	КонецЕсли;
	
	Выборка = РезультатЗапроса.Выбрать();
	Выборка.Следующий();
	
	НайденнаяСсылка = Выборка.Ссылка;
	
	// Сохраняем найденный элемент в контексте выполнения
	КонтекстВыполнения.Вставить("ТекущийОбъект", НайденнаяСсылка.ПолучитьОбъект());
	КонтекстВыполнения.Вставить("ТипОбъекта", "Справочник");
	КонтекстВыполнения.Вставить("ИмяОбъекта", ИмяСправочника);
	
	Результат.Успех = Истина;
	Результат.Сообщение = "Найден элемент справочника '" + ИмяСправочника + "' с наименованием '" + ИмяДляПоиска + "'";
	Результат.Данные = НайденнаяСсылка;
	
	Возврат Результат;
	
КонецФункции

// Выполняет действие SetField
//
// Параметры:
//  Шаг - Структура - структура шага
//  КонтекстВыполнения - Структура - контекст выполнения (входной/выходной)
//
// Возвращаемое значение:
//  Структура - структура результата
//
Функция ВыполнитьSetField(Шаг, КонтекстВыполнения)
	
	Результат = Новый Структура;
	Результат.Вставить("Успех", Ложь);
	Результат.Вставить("Сообщение", "");
	Результат.Вставить("Данные", Неопределено);
	
	// Проверяем наличие текущего объекта в контексте
	Если НЕ КонтекстВыполнения.Свойство("ТекущийОбъект") Тогда
		Результат.Сообщение = "Нет текущего объекта для установки поля. Используйте CreateReference, CreateDocument или FindReferenceByName перед SetField";
		Возврат Результат;
	КонецЕсли;
	
	ТекущийОбъект = КонтекстВыполнения.ТекущийОбъект;
	ТипОбъекта = КонтекстВыполнения.ТипОбъекта;
	ИмяОбъекта = КонтекстВыполнения.ИмяОбъекта;
	
	ИмяПоля = Шаг.field;
	Значение = Шаг.value;
	
	// Проверяем существование реквизита
	Если ТипОбъекта = "Справочник" Тогда
		
		Если НЕ ИИА_Метаданные.СуществуетРеквизитСправочника(ИмяОбъекта, ИмяПоля) Тогда
			Результат.Сообщение = "Реквизит '" + ИмяПоля + "' не найден в справочнике '" + ИмяОбъекта + "'";
			Возврат Результат;
		КонецЕсли;
		
	ИначеЕсли ТипОбъекта = "Документ" Тогда
		
		Если НЕ ИИА_Метаданные.СуществуетРеквизитДокумента(ИмяОбъекта, ИмяПоля) Тогда
			Результат.Сообщение = "Реквизит '" + ИмяПоля + "' не найден в документе '" + ИмяОбъекта + "'";
			Возврат Результат;
		КонецЕсли;
		
	КонецЕсли;
	
	// Устанавливаем значение поля
	Попытка
		
		УстановитьЗначениеРеквизита(ТекущийОбъект, ИмяПоля, Значение);
		
	Исключение
		
		Результат.Сообщение = "Ошибка установки значения поля '" + ИмяПоля + "': " + ОписаниеОшибки();
		Возврат Результат;
		
	КонецПопытки;
	
	Результат.Успех = Истина;
	Результат.Сообщение = "Установлено значение поля '" + ИмяПоля + "'";
	
	Возврат Результат;
	
КонецФункции

// Выполняет действие Write
//
// Параметры:
//  Шаг - Структура - структура шага
//  КонтекстВыполнения - Структура - контекст выполнения (входной/выходной)
//
// Возвращаемое значение:
//  Структура - структура результата
//
Функция ВыполнитьWrite(Шаг, КонтекстВыполнения)
	
	Результат = Новый Структура;
	Результат.Вставить("Успех", Ложь);
	Результат.Вставить("Сообщение", "");
	Результат.Вставить("Данные", Неопределено);
	
	// Проверяем наличие текущего объекта в контексте
	Если НЕ КонтекстВыполнения.Свойство("ТекущийОбъект") Тогда
		Результат.Сообщение = "Нет текущего объекта для записи. Используйте CreateReference, CreateDocument или FindReferenceByName перед Write";
		Возврат Результат;
	КонецЕсли;
	
	ТекущийОбъект = КонтекстВыполнения.ТекущийОбъект;
	
	// Записываем объект
	Попытка
		
		ТекущийОбъект.Записать();
		
	Исключение
		
		Результат.Сообщение = "Ошибка записи объекта: " + ОписаниеОшибки();
		Возврат Результат;
		
	КонецПопытки;
	
	Результат.Успех = Истина;
	Результат.Сообщение = "Объект успешно записан";
	Результат.Данные = ТекущийОбъект.Ссылка;
	
	Возврат Результат;
	
КонецФункции

// Выполняет действие RunQuery
//
// Параметры:
//  Шаг - Структура - структура шага
//
// Возвращаемое значение:
//  Структура - структура результата
//
Функция ВыполнитьRunQuery(Шаг)
	
	Результат = Новый Структура;
	Результат.Вставить("Успех", Ложь);
	Результат.Вставить("Сообщение", "");
	Результат.Вставить("Данные", Неопределено);
	
	ТекстЗапроса = Шаг.query;
	
	// Проверяем, что запрос не содержит опасных операций
	// (только SELECT разрешен)
	ТекстЗапросаВерхний = ВРег(ТекстЗапроса);
	
	Если СтрНайти(ТекстЗапросаВерхний, "ИЗМЕНИТЬ") > 0 
		ИЛИ СтрНайти(ТекстЗапросаВерхний, "УДАЛИТЬ") > 0 
		ИЛИ СтрНайти(ТекстЗапросаВерхний, "ВСТАВИТЬ") > 0 
		ИЛИ СтрНайти(ТекстЗапросаВерхний, "ОБНОВИТЬ") > 0 Тогда
		
		Результат.Сообщение = "Запрос содержит операции модификации данных. Разрешены только SELECT запросы";
		Возврат Результат;
		
	КонецЕсли;
	
	// Выполняем запрос
	Попытка
		
		Запрос = Новый Запрос(ТекстЗапроса);
		РезультатЗапроса = Запрос.Выполнить();
		
		// Преобразуем результат в таблицу значений для возврата
		ТаблицаРезультатов = РезультатЗапроса.Выгрузить();
		
		Результат.Успех = Истина;
		Результат.Сообщение = "Запрос выполнен успешно. Получено строк: " + Формат(ТаблицаРезультатов.Количество(), "ЧН=0");
		Результат.Данные = ТаблицаРезультатов;
		
	Исключение
		
		Результат.Сообщение = "Ошибка выполнения запроса: " + ОписаниеОшибки();
		
	КонецПопытки;
	
	Возврат Результат;
	
КонецФункции

// Выполняет действие ShowInfo
//
// Параметры:
//  Шаг - Структура - структура шага
//
// Возвращаемое значение:
//  Структура - структура результата
//
Функция ВыполнитьShowInfo(Шаг)
	
	Результат = Новый Структура;
	Результат.Вставить("Успех", Истина);
	Результат.Вставить("Сообщение", Шаг.message);
	Результат.Вставить("Данные", Неопределено);
	
	Возврат Результат;
	
КонецФункции

// Устанавливает значение реквизита объекта
//
// Параметры:
//  Объект - Произвольный - объект справочника или документа
//  ИмяРеквизита - Строка - имя реквизита
//  Значение - Произвольный - значение для установки
//
Процедура УстановитьЗначениеРеквизита(Объект, ИмяРеквизита, Значение)
	
	// Используем рефлексию для установки значения
	Если ТипЗнч(Объект) = Тип("СправочникОбъект") Тогда
		
		Объект[ИмяРеквизита] = Значение;
		
	ИначеЕсли ТипЗнч(Объект) = Тип("ДокументОбъект") Тогда
		
		Объект[ИмяРеквизита] = Значение;
		
	Иначе
		
		ВызватьИсключение "Неподдерживаемый тип объекта для установки реквизита";
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти
