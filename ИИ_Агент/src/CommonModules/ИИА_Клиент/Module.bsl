#Область ПрограммныйИнтерфейс

// Находит или создает диалог текущего пользователя
//
// Возвращаемое значение:
//  СправочникСсылка.ИИА_Диалоги - ссылка на диалог
//
Функция НайтиИлиСоздатьДиалогПользователя() Экспорт
	
	Возврат ВызватьСерверныйМетод("ИИА_Сервер.НайтиИлиСоздатьДиалогПользователя", ТекущийПользователь());
	
КонецФункции

// Загружает сообщения диалога
//
// Параметры:
//  СсылкаДиалога - СправочникСсылка.ИИА_Диалоги - ссылка на диалог
//
// Возвращаемое значение:
//  ТаблицаЗначений - таблица с сообщениями для формы
//
Функция ЗагрузитьСообщенияДиалога(СсылкаДиалога) Экспорт
	
	Сообщения = ВызватьСерверныйМетод("ИИА_Сервер.ПолучитьСообщенияДиалога", СсылкаДиалога, 50);
	
	// Преобразуем в таблицу для формы
	ТаблицаФормы = Новый ТаблицаЗначений;
	ТаблицаФормы.Колонки.Добавить("Время", Новый ОписаниеТипов("ДатаВремя"));
	ТаблицаФормы.Колонки.Добавить("Автор", Новый ОписаниеТипов("ПеречислениеСсылка.ИИА_АвторСообщения"));
	ТаблицаФормы.Колонки.Добавить("ТипСообщения", Новый ОписаниеТипов("ПеречислениеСсылка.ИИА_ТипСообщения"));
	ТаблицаФормы.Колонки.Добавить("Текст", Новый ОписаниеТипов("Строка"));
	ТаблицаФормы.Колонки.Добавить("ТекстКода", Новый ОписаниеТипов("Строка"));
	ТаблицаФормы.Колонки.Добавить("Статус", Новый ОписаниеТипов("Строка"));
	ТаблицаФормы.Колонки.Добавить("UsageTokens", Новый ОписаниеТипов("Число", , , Новый КвалификаторыЧисла(15, 0)));
	
	Для Каждого Строка Из Сообщения Цикл
		
		НоваяСтрока = ТаблицаФормы.Добавить();
		НоваяСтрока.Время = Строка.Время;
		НоваяСтрока.Автор = Строка.Автор;
		НоваяСтрока.ТипСообщения = Строка.ТипСообщения;
		НоваяСтрока.Текст = Строка.Текст;
		НоваяСтрока.ТекстКода = Строка.ТекстКода;
		НоваяСтрока.Статус = Строка.Статус;
		НоваяСтрока.UsageTokens = Строка.UsageTokens;
		
	КонецЦикла;
	
	Возврат ТаблицаФормы;
	
КонецФункции

// Отправляет сообщение и получает ответ от ИИ
//
// Параметры:
//  СсылкаДиалога - СправочникСсылка.ИИА_Диалоги - ссылка на диалог
//  ТипСообщения - Строка - тип сообщения ("Чат" или "Запрос")
//  Текст - Строка - текст сообщения
//
// Возвращаемое значение:
//  Структура - структура ответа от сервера (содержит Usage и другую информацию)
//
Функция ОтправитьСообщение(СсылкаДиалога, ТипСообщения, Текст) Экспорт
	
	Результат = ВызватьСерверныйМетод("ИИА_Сервер.ОтправитьСообщениеСервера", СсылкаДиалога, ТипСообщения, Текст);
	
	Возврат Результат;
	
КонецФункции

// Проверяет запрос 1С
//
// Параметры:
//  ТекстЗапроса - Строка - текст запроса
//
// Возвращаемое значение:
//  Структура - структура результата:
//   * Успех - Булево - успешность выполнения
//   * Сообщение - Строка - текст ошибки или пусто
//
Функция ПроверитьЗапрос(ТекстЗапроса) Экспорт
	
	Результат = ВызватьСерверныйМетод("ИИА_Сервер.ПроверитьЗапрос", ТекстЗапроса);
	
	Возврат Результат;
	
КонецФункции

#КонецОбласти


